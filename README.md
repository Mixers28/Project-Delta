# Project Delta — Card-Based Puzzle Game

A Unity C# project implementing a solitaire-style card game with pattern matching, scoring multipliers, and level goals.

## Quick Start

### Opening the Project
1. Clone the repository
2. Open in **Unity Editor 2022.3.62f3** or later
3. Open `Assets/Scenes/GameScene.unity`
4. Press **Play** to start the game

### Running Tests
Use the **Unity Test Runner** (Window → General → Test Runner):
- **Play Mode tests** — Run gameplay scenarios
- **Edit Mode tests** — Run pattern validation rules

See `.github/copilot-instructions.md` for detailed developer workflows and architecture guidance.
### Current Build Status
- Tests not run here (Unity editor/build not executed in CLI). Run Play/Edit Mode tests in Unity Test Runner to verify locally.

### Recent Gameplay Changes
- Added level progression that generates a new Stage on each win (harder goals/moves/deck tweaks); Continue advances the stage.
- Retry now resets progression to Stage 1 (base goals) to allow a fresh attempt after failure.
- Playing a pattern no longer consumes a move, making goal completion more achievable within move limits.
- Tutorial revamped to a 7-rule progression: Pair, Three of a Kind, Four of a Kind, Suited Run (3), Straight Run (3), Color Run (3), Flush.
- Suit/Color Set patterns removed from gameplay.
- Explicit per-level pattern gating now overrides exclusion rules (tutorial-specific patterns always valid).
- HUD overlay cleaned up: shows only Stage and goals (deck/level labels removed).
- Action panel simplified to three buttons: Draw Stock, Draw Discard, Play Pattern.
- Draw Stock now discards selected cards first (when over hand limit) then refills from stock.
- UI polish: themed action buttons, subtle card shadows, and slight lift on selected cards.

## Project Structure

```
Assets/
├── Scripts/
│   ├── Managers/
│   │   ├── GameManager.cs      (Singleton, orchestrates gameplay)
│   │   └── GameState.cs        (Game rules, events, player actions)
│   ├── Models/
│   │   ├── Card.cs             (Suit/Rank structure, display formatting)
│   │   ├── Deck.cs             (Draw/discard piles, shuffling)
│   │   └── Goal.cs             (Level objectives, progress tracking)
│   ├── Patterns/
│   │   ├── AllPatterns.cs      (IPattern interface, Pair/Three/Run/Straight/Color, PatternValidator)
│   │   ├── FourOfKindPattern.cs (4 cards, same rank)
│   │   ├── FlushPattern.cs      (5 cards, same suit)
│   │   ├── FullHousePattern.cs  (5 cards, 3-of-a-kind + pair)
│   │   ├── RoyalFlushPattern.cs (5 cards, 10-J-Q-K-A same suit)
│   │   └── PatternSelection.cs  (Goal-aware best pattern selection)
│   └── UI/
│       ├── ActionButtons.cs      (Draw/Play/Discard controls)
│       ├── CardDisplay.cs        (Individual card rendering)
│       ├── GameHUD.cs            (Score/moves/goals display)
│       ├── GameOverPanel.cs      (Win/lose screen)
│       └── HandDisplay.cs        (7-card hand management)
└── Tests/
    └── PatternTests.cs          (20+ unit tests)
```

## Game Mechanics

### Card Model
- **Deck:** 52 standard cards + 2 jokers (54 total)
- **Suits:** Hearts (♥), Diamonds (♦), Clubs (♣), Spades (♠), Joker (★)
- **Ranks:** Ace–King, plus Joker

### Patterns (Valid Plays)
- **Pair** (2 cards): Same rank or both jokers → **10 pts**
- **Three of a Kind** (3 cards): Same rank, jokers as wildcards → **30 pts**
- **Four of a Kind** (4 cards): Same rank, jokers as wildcards → **120 pts**
- **Suited Run** (3, 4, or 5 cards): Same suit in sequence, jokers fill gaps → **40/80/150 pts**
- **Straight Run** (3, 4, or 5+ cards): Any suits in sequence, jokers fill gaps → **40/80/150 pts**
- **Color Run** (3 or 4 cards): Same color in sequence, jokers fill gaps → **40/80 pts**
- **Flush** (5 cards): All same suit → **100 pts**
- **Full House** (5 cards): 3-of-a-kind + pair, jokers as wildcards → **200 pts**
- **Royal Flush** (5 cards): 10-J-Q-K-A same suit (no jokers) → **250 pts**

### Scoring Multipliers
- Joker in hand: ×1.5
- All non-jokers are face cards (J, Q, K): ×2
- All cards different suits: ×1.2 (if count equals unique suits)

### Level Goals
A level is won by completing all goals within the move limit. Goals track:
- Number of pairs (three/four-of-a-kind also satisfy), three-of-a-kinds (four-of-a-kind also satisfies), run types (straight/suited/color), flushes (royal flush also satisfies), and full houses played
- Total score reached

### Gameplay Flow
1. Player draws from stock or discard pile
2. Player selects cards and plays a valid pattern
3. `PatternValidator` finds the best-scoring match
4. Score increases, goals update, events fire for UI refresh
5. Win/lose conditions checked each turn

## Developer Workflows

### Building
- **C# Project Files:** Auto-generated by Unity; excluded from git
- **Compile:** Open solution in Visual Studio or use Unity Editor

### Debugging
Add `Debug.Log` in:
- `GameManager.cs` for gameplay flow
- `GameState.cs` event handlers for state changes
- Pattern classes for validation logic
- Use `card.Display` for readable card output (e.g., "5♥", "★JKR")

### Adding Features

**Add a new pattern:**
1. Create `Assets/Scripts/Patterns/MyPattern.cs` implementing `IPattern`
2. Register in `PatternValidator()` constructor in `AllPatterns.cs`
3. Add unit tests in `Assets/Tests/PatternTests.cs`

**Add a new goal type:**
1. Add enum value to `Goal.GoalType`
2. Implement mapping in `Goal.MatchesPattern()` switch
3. Use in `GameManager.StartTestLevel()` when building level goals

**Adjust deck composition:**
1. Edit `Deck.Reset()` in `Assets/Scripts/Models/Deck.cs`
2. Currently builds 52 cards + 2 jokers, then Fisher-Yates shuffles

## Architecture Highlights

### Singleton Pattern
`GameManager.Instance` provides global access to:
- `CurrentGame` (GameState)
- `PatternValidator` (pattern detection)

### Event-Driven UI Updates
`GameState` fires public events that UI components subscribe to:
- `OnCardDrawn`, `OnCardDiscarded`
- `OnPatternPlayed`, `OnScoreChanged`
- `OnGoalUpdated`, `OnHandChanged`

### Pattern Validation
`PatternValidator.GetBestPattern(cards)` returns the highest-scoring valid match, considering:
- All registered pattern types (pairs, kinds, runs, flushes, full house, royal flush)
- Joker wildcards (except Royal Flush)
- Level gating: when `allowedPatterns` is specified, exclusions are skipped so explicit rules always apply
- Scoring multipliers

## Technology Stack
- **Engine:** Unity 2022.3.62f3
- **Language:** C# (.NET Standard 2.1)
- **Testing:** Unity Test Runner (Edit Mode + Play Mode)
- **VCS:** Git (GitHub)

## License & Attribution
See individual files for license headers. This project implements custom game rules inspired by solitaire variants.

## AI Agent Guidance
For AI coding assistants (Copilot, Claude, etc.), see `.github/copilot-instructions.md` for:
- Big picture architecture
- Project-specific conventions
- Common extension patterns
- Developer workflows

### Local Agent Memory Workflow
This repo uses a lightweight “files as memory” workflow under `docs/`:
- `docs/PROJECT_CONTEXT.md` (long-term memory)
- `docs/NOW.md` (working memory / current focus)
- `docs/SESSION_NOTES.md` (append-only session log)

Roles live in `.github/agents/` and the session ritual is documented in `docs/AGENT_SESSION_PROTOCOL.md` (helpers in `scripts/` and VS Code tasks in `.vscode/tasks.json`).
